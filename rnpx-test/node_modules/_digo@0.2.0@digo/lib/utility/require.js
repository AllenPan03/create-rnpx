"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const np = require("path");
/**
 * 允许 require 从指定的文件夹载入模块。
 * @param paths 要载入的模块所在文件夹路径。
 */
function addRequirePath(...paths) {
    for (let i = 0; i < paths.length; i++) {
        paths[i] = np.resolve(paths[i]);
    }
    const Module = require("module").Module;
    const oldResolveLookupPaths = Module._resolveLookupPaths;
    Module._resolveLookupPaths = function (request, parent) {
        const result = oldResolveLookupPaths.apply(this, arguments);
        const all = Array.isArray(result[1]) ? result[1] : result;
        // 仅当请求全局模块时，追加全局搜索路径。
        if (!/^[\.\/\\]|:/.test(request) && !np.isAbsolute(request)) {
            for (const path of paths) {
                if (all.indexOf(path) < 0) {
                    all.push(path);
                }
            }
        }
        return result;
    };
}
exports.addRequirePath = addRequirePath;
/**
 * 解析指定模块的绝对路径。
 * @param module 要解析的模块路径。
 * @return 返回已解析的模块绝对路径。如果找不到模块则返回 undefined。
 */
function resolveRequirePath(module) {
    if (/^[\.\/\\]|:/.test(module)) {
        try {
            return require.resolve(np.resolve(module));
        }
        catch (e) { }
    }
    else {
        let dir = process.cwd();
        let prevDir;
        do {
            try {
                return require.resolve(np.resolve(dir, "node_modules", module));
            }
            catch (e) { }
            prevDir = dir;
            dir = np.dirname(dir);
        } while (dir.length !== prevDir.length);
    }
}
exports.resolveRequirePath = resolveRequirePath;
